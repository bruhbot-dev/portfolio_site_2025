{% extends "base.html" %}

{% block title %}{{ photo.title or "Photo Details" }}{% endblock %}

{% block content %}
<div class="container mt-5">

    <!-- Back Button -->
    <a href="{{ url_for('main.gallery') }}" class="btn btn-secondary mb-4">‚Üê Back to Gallery</a>

    <!-- Photo + Info -->
    <div class="row photo-detail-row">
        
        <!-- LEFT COLUMN: Image -->
        <div class="col-md-8">
            <img 
                src="{{ url_for('static', filename='uploads/' ~ photo.filename) }}"
                alt="{{ photo.title }}"
                class="img-fluid rounded shadow photo-detail-img"
                id="photoFullscreen"
                style="cursor: zoom-in;"
            >
        </div>

        <!-- RIGHT COLUMN: Info -->
        <div class="col-md-4 photo-info">
            <h2>{{ photo.title or "Untitled" }}</h2>

            {% if photo.description %}
            <p class="mt-3">{{ photo.description }}</p>
            {% endif %}

{% if photo.tags %}
<p class="text-muted">
    <strong>Tags:</strong>
    {% for tag in photo.tags %}
<a href="{{ url_for('main.gallery', tag=tag.name) }}" 
   class="badge bg-primary text-decoration-none">
    {{ tag.name }}
</a>
    {% endfor %}
</p>
{% endif %}


            {% if current_user.is_authenticated %}
            <form action="{{ url_for('admin.delete_photo', id=photo.id) }}" method="POST" class="mt-4">
                <button class="btn btn-danger" type="submit">Delete Photo</button>
            </form>
            {% endif %}
        </div>

    </div>
</div>

{% endblock %}

{% block body_extra %}
<!-- Fullscreen Lightbox Overlay -->
<div id="lightboxOverlay" class="lightbox-overlay" onclick="closeLightbox()">
    <img id="lightboxImage" class="lightbox-image">
</div>

<script>
    const image = document.getElementById("photoFullscreen");
    const overlay = document.getElementById("lightboxOverlay");
    const overlayImg = document.getElementById("lightboxImage");

    image.onclick = () => {
        overlay.style.display = "flex";
        overlayImg.src = image.src;
        document.body.style.overflow = "hidden";
    };

    function closeLightbox() {
        overlay.style.display = "none";
        document.body.style.overflow = "auto";
    }

    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeLightbox();
    });
</script>

{% endblock %}
